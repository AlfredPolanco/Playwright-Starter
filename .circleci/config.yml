# Use the latest 2.1 version of CircleCI pipeline process engine.
# See: https://circleci.com/docs/2.0/configuration-reference
version: 2.1

# Define a job to be invoked later in a workflow.
# See: https://circleci.com/docs/2.0/configuration-reference/#jobs

jobs:

description: |
  Prettier is an opinionated formatter https://github.com/prettier/prettier
  Check files that are different from Prettier formatting in your repository.
  https://github.com/miyajan/prettier-orb

commands:
  prettier_list_different:
    description: |
      Run prettier --list-different over files in the repository.
    parameters:
      ignore_path:
        description: |
          https://prettier.io/docs/en/cli.html#ignore-path
          Path to a file containing patterns that describe files to ignore.
          By default, prettier looks for ./.prettierignore
        type: string
        default: ./.prettierignore
      extension:
        description: |
          Files that have this extension are checked by prettier.
          To specify multiple extensions, use comma separated string. (e.g. yml,yaml)
        type: string
    steps:
      - run:
          name: Run Prettier << parameters.extension >>
          command: prettier --ignore-path '<< parameters.ignore_path >>' --list-different **/*.{<< parameters.extension >>}

executors:
  prettier:
    docker:
      - image: miyajan/prettier:1.15.3

  run-test:
    docker:
      - image: mcr.microsoft.com/playwright:v1.23.1-focal
    # Steps to the job
    steps:
      - checkout
      - run: npm i -D @playwright/test
      - run: npx playwright install --with-deps
      - run:
          name: Run test
          command: PLAYWRIGHT_JUNIT_OUTPUT_NAME=results.xml npx playwright test --reporter=junit
      - store_test_results:
          path: results.xml
# Invoke jobs via workflows
workflows:
  run-test-workflow:
    jobs:
      - run-test
